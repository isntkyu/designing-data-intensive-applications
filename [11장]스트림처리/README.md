## 스트림 처리

일괄처리는 출력이 파생데이터 형태이고, 다시 수행해서 재생성 가능한 데이터셋이다.  
하지만, 입력크기를 유한한 크기로 한정한다는 가정이 있다.  
입력이 한정되지 않는다면, 일정 청크로 입력을 나눠야할 것이고, 그 기준을 이벤트 단위로 잡는 것이 스트림 처리의 개념이다.

### 이벤트 스트림 전송

이벤트는 일반적으로 발생 타임스탬프를 포함한다.  
파일 시스템에서는 관련 레코드 집합을 파일 이름으로 식별하지만 스트림 시스템에서는 대개 **토픽**이나 스트림으로 이벤트를 묶는다.

#### 메시징 시스템

소비자가 메시지를 처리하는 속도보다 빠르게 메시지를 생산한다면,  
유닉스파이프와 TCP는 배압(메시지를 못보내게 막음)을 사용한다.  
메시지가 큐에 버퍼링될 때 어떤 현상이 생길지 이해하는게 중요하다.  
(시스템이 중단되는가, 성능이 저하되는가)

#### 생산자에서 소비자로 메시지를 직접 전달하기

많은 메시지 시스템은 노드를 통하지 않고 네트워크로 직접 통신한다.  
직접 메시징 시스템에서는 메시지 유실을 대비한 애플리케이션 코드를 짜야한다.

#### 메시지 브로커

- 메시지큐 라고도 한다. 메시지 스트림을 처리하는 데 최적화된 데이터베이스며 서버로 구동된다.
- 클라이언트의 상태변경에 쉽게 대처할 수 있다.
- 어떤 메시지 브로커는 메모리에 보관하지만, 다른 브로커는 백업용 디스크에 보관한다.
- 배압을 사용하지 않고 큐를 늘리는 설정도 있을 수 있다.
- 소비자가 비동기로 동작한다. (생산자가 메시지 처리여부를 확인하지 않음)

#### 메시지 브로커와 데이터베이스의 비교

- 브로커는 컨슈머에게 배달이 성공하면 메시지를 삭제한다.
- 큐(작업 집합) 크기가 작다. 소비자가 느리면 메모리가 넘쳐서 디스크에 저장할 수도 있어서 처리량이 저하된다.
- 데이터베이스는 스냅숏을 기준으로 질의한다. 브로커는 질의는 불가하지만 변경(새 이벤트) 즉각 클라이언트에게 알려준다.
